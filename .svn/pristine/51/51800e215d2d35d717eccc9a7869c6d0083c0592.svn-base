import React, { useState } from 'react';
import YearsStatsChart from './components/YearsStatsChart';
import DemographicStatsChart from './components/DemographicStatsChart';
import DailyPatientStatsChart from './components/DailyPatientStatsChart';

const IS_DEMO = true;
const BASE_YEAR = IS_DEMO ? 2026 : new Date().getFullYear();
const YEAR_OPTIONS = Array.from({ length: 4 }, (_, i) => BASE_YEAR - 2 + i); // [2024, 2025, 2026, 2027]

// 탭 설정
const TAB_CONFIG = [
  {
    key: 'revenue',
    group: '매출 분석',
    label: '날짜별 매출 현황',
    description: (year) => `${year}년도 월별 손익 지표 및 상세 내역`,
    statsType: 'revenue', 
    Component: YearsStatsChart,
  },
  {
    key: 'patient_daily',
    group: '환자 분석',
    label: '일별 신규/재방문 추이',
    description: (year) => `${year}년도 일자별 환자 유입 및 재방문 상세 현황`,
    statsType: 'daily',
    Component: DailyPatientStatsChart,
  },
  {
    key: 'patient',
    group: '환자 분석',
    label: '환자 현황(외래&입원)',
    description: (year) => `${year}년도 환자 유형별 누적 통계`,
    statsType: 'patient',
    Component: YearsStatsChart, 
  },
  {
    key: 'demographics',
    group: '환자 분석',
    label: '환자 성별/연령 분포',
    description: (year) => `${year}년도 내원 환자 인구통계학적 분포`,
    statsType: 'demographics',
    Component: DemographicStatsChart,
  },
];

const StatisticsManager = () => {
  const [activeTabKey, setActiveTabKey] = useState('revenue'); 
  const [year, setYear] = useState(BASE_YEAR);
  const activeTabInfo = TAB_CONFIG.find(tab => tab.key === activeTabKey) ?? TAB_CONFIG[0];
  const ActiveComponent = activeTabInfo.Component;

  return (
    <div className="flex w-full gap-4 h-[calc(100vh-140px)] font-['Pretendard'] text-zinc-950">
      {/* 통계 고정 사이드바 */}
      <aside className="w-64 shrink-0 rounded-xl bg-white border border-slate-200 shadow-sm flex flex-col overflow-hidden">
         <div className="p-5 border-b border-slate-100 flex items-center gap-2 bg-slate-50/50">
          <div className="w-1 h-4 bg-blue-600 rounded-full"></div>
          <h2 className="text-base font-bold text-slate-800">병원 통계 인사이트</h2>
        </div>
        
        <div className="flex-1 p-3 space-y-1 overflow-y-auto custom-scrollbar">
          {TAB_CONFIG.map((tab, index) => {
            const prevGroup = TAB_CONFIG[index - 1]?.group;
            const showGroupLabel = tab.group !== prevGroup;

            return (
              <React.Fragment key={tab.key}>
                {showGroupLabel && (
                  <div className="px-3 py-2 text-[11px] font-bold text-slate-400 uppercase tracking-wider mt-3">
                    {tab.group}
                  </div>
                )}
                <button onClick={() => setActiveTabKey(tab.key)}
                  className={`w-full text-left px-4 py-3 rounded-xl transition-all text-sm font-bold flex justify-between items-center
                    ${activeTabKey === tab.key ? 'bg-blue-50 text-blue-600 shadow-sm ring-1 ring-blue-100' : 'hover:bg-slate-50 text-slate-600'}`}>
                    {tab.label}
                    {activeTabKey === tab.key && <span className="w-1.5 h-1.5 rounded-full bg-blue-600"></span>}
                </button>
              </React.Fragment>
            );
          })}
        </div>
      </aside>

      {/* --- 메인 컨텐츠 --- */}
      <section className="flex-1 rounded-xl bg-white border border-slate-200 shadow-sm flex flex-col min-w-0">
        
        {/* 헤더 */}
        <div className="px-6 py-4 border-b border-slate-100 flex justify-between items-center bg-white shrink-0 rounded-t-xl">
          <div>
            <h2 className="text-lg font-bold text-slate-900">{activeTabInfo.label}</h2>
            <p className="text-xs text-slate-500 mt-1 font-medium">
              {activeTabInfo.description(year)}
            </p>
          </div>
          <div className="flex gap-2">
            <select value={year} onChange={(e) => setYear(Number(e.target.value))}
              className="bg-slate-50 border border-slate-200 rounded-lg px-3 py-1.5 text-xs font-bold outline-none cursor-pointer hover:border-blue-400 transition-colors">
              {YEAR_OPTIONS.map(y => (
                <option key={y} value={y}>{y}년</option>
              ))}
            </select>
          </div>
        </div>

        {/* 차트 영역 */}
        <div className="flex-1 p-5 bg-slate-50/30 overflow-visible min-h-0 relative">
             <ActiveComponent year={year} statsType={activeTabInfo.statsType}/>
        </div>

      </section>
    </div>
  );
};

export default StatisticsManager;